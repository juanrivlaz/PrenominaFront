<h2 mat-dialog-title>{{ data.editData ? 'Editar usuario' : 'Agregar usuario' }}</h2>
<mat-dialog-content>
    <form [formGroup]="createForm" class="mt-12">
        <mat-form-field class="mb-12">
            <mat-label>Ingrese un nombre</mat-label>
            <mat-icon matPrefix>badge</mat-icon>
            <input type="text" matInput formControlName="name">
            @if (getFieldControl('name')?.hasError('required')) {
                <mat-error>
                  El nombre es requerido
                </mat-error>
            }
        </mat-form-field>
        <mat-form-field class="mb-12">
            <mat-label>Ingrese un email</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input type="email" matInput formControlName="email">
            @if (getFieldControl('email')?.hasError('required')) {
                <mat-error>
                  El email es requerido
                </mat-error>
            }
            @if (getFieldControl('email')?.hasError('email')) {
                <mat-error>
                  El email no es valido
                </mat-error>
            }
        </mat-form-field>

        <mat-form-field class="mb-12">
            <mat-label>Seleccione un role</mat-label>
            <mat-icon matPrefix>group</mat-icon>
            <mat-select formControlName="roleId">
                <mat-option *ngFor="let role of data.roles" [value]="role.id">{{ role.label }}</mat-option>
            </mat-select>
            @if (getFieldControl('roleId')?.hasError('required')) {
                <mat-error>
                  El role es requerido
                </mat-error>
            }
        </mat-form-field>

        <mat-form-field class="mb-12">
            <mat-label>Seleccione una o más empresas</mat-label>
            <mat-icon matPrefix>apartment</mat-icon>
            <mat-select formControlName="companies" multiple>
                @for (company of data.companies; track company) {
                    <mat-option [value]="company.id">{{ company?.name }} | {{ company?.rfc }}</mat-option>
                }
            </mat-select>
            @if (getFieldControl('companies')?.hasError('required')) {
                <mat-error>
                  La empresa es requerida
                </mat-error>
            }
        </mat-form-field>

        <mat-form-field class="mb-12">
            <mat-label>Seleccione uno o más departemento/supervisor</mat-label>
            <mat-icon matPrefix>domain</mat-icon>
            <mat-select formControlName="tenants" multiple [compareWith]="compareTenant">
                @for (tenant of tenants; track tenant) {
                    <mat-option [value]="tenant"><b>{{ tenant?.label }}</b> | <span class="fs-11">{{ tenant?.company }}</span></mat-option>
                }
            </mat-select>
            @if (getFieldControl('tenants')?.hasError('required')) {
                <mat-error>
                  El departamento/supervisor es requerido
                </mat-error>
            }
        </mat-form-field>

        <mat-form-field class="mb-12">
            <mat-label>Contraseña</mat-label>
            <mat-icon matPrefix>password</mat-icon>
            <input type="password" matInput formControlName="password">
            @if (getFieldControl('password')?.hasError('required')) {
                <mat-error>
                  La contraseña es requerida
                </mat-error>
            }
            @if (getFieldControl('password')?.hasError('minlength')) {
                <mat-error>
                  Caracteres mínimos 6
                </mat-error>
            }
        </mat-form-field>
        <mat-form-field class="mb-12">
            <mat-label>Confirmar Contraseña</mat-label>
            <mat-icon matPrefix>password</mat-icon>
            <input type="password" matInput formControlName="confirmPassword">
            @if (getFieldControl('confirmPassword')?.hasError('required')) {
                <mat-error>
                  La confirmación es requerida
                </mat-error>
            }
            @if (getFieldControl('confirmPassword')?.hasError('errorEqualPassword')) {
                <mat-error>
                  La contraseña no es igual
                </mat-error>
            }
            @if (getFieldControl('confirmPassword')?.hasError('minlength')) {
                <mat-error>
                  Caracteres mínimos 6
                </mat-error>
            }
        </mat-form-field>
    </form>
</mat-dialog-content>
<mat-dialog-actions>
    @if (!loading()) {
        <button mat-button (click)="onCancel()" cdkFocusInitial>Cancelar</button>
        <button mat-flat-button (click)="submit()" [disabled]="createForm.invalid">{{ data.editData ? 'Guardar' : 'Agregar' }}</button>
    } @else {
        <mat-spinner diameter="30"></mat-spinner>
    }
</mat-dialog-actions>